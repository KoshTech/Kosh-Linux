# Kosh Linux Package File
# Specification at: http://koshlinux.com/

info:
  name: Backup System
  homepage: http://koshlinux.org/
  description: "Recipe for backup the new built system."
  optional: recommended

fetch:
  do: no

unpack:
  do: no

configure:
  do: no

make:
  do: no

variables:
  set: |    
    SYSTEM_BUILD=$(cat Work/built_*)
    BACKUP_FOLDER="$BUILD/Depot/Backup/$SYSTEM_BUILD"

make_install:
  do: |
    if [ ! -d "$BACKUP_FOLDER" ]; then
      echo 'Making backup';
      sudo mkdir -p $BACKUP_FOLDER
      sudo cp -va /tools/* $BACKUP_FOLDER/ || exit 1;
    fi;

  pre: |
    if [ -z $SYSTEM_BUILD ]; then 
      SYSTEM_BUILD=$(date -u +%Y%m%d%H%M%S);
      echo "$SYSTEM_BUILD"> "built_utc_$SYSTEM_BUILD";
    else
      echo "Already exists build: $SYSTEM_BUILD"
    fi
